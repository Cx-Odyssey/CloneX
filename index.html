<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX Odyssey: Rise of the Collectors</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <!-- Enhanced Starfield Background -->
        <div class="stars" id="starfield"></div>

        <!-- Loading Screen -->
        <div class="screen active" id="loadingScreen">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                <div class="logo" style="font-size: 48px; margin-bottom: 30px; animation: logoFloat 3s ease-in-out infinite alternate;">CX ODYSSEY</div>
                <div style="font-size: 20px; margin-bottom: 40px; opacity: 0.9;">Loading game...</div>
                <div class="loading"></div>
                <div id="tgInitStatus" style="margin-top: 30px; font-size: 16px; color: var(--primary-gold);">
                    Initializing Telegram WebApp
                </div>
            </div>
        </div>

        <!-- Main Galaxy Map Screen -->
        <div class="screen" id="galaxyScreen">
            <div class="header">
                <div class="logo">CX ODYSSEY</div>
                <div class="resources">
                    <div class="resource">‚ö° <span id="energy">100</span></div>
                    <div class="resource">üíé <span id="shards">0</span></div>
                    <div class="resource">üèÜ <span id="gp">0</span></div>
                </div>
            </div>
            
            <div class="tg-user-info" id="tgUserInfo">
                <img class="tg-avatar" id="tgAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FFD700'/%3E%3Ctext x='50' y='65' text-anchor='middle' font-size='40' fill='%23000'%3Eüë§%3C/text%3E%3C/svg%3E">
                <div>
                    <div id="tgUserName" style="font-weight: 700; font-size: 18px;">Player</div>
                    <div style="font-size: 14px; opacity: 0.8;">Level <span id="tgUserLevel">1</span> Explorer</div>
                </div>
            </div>
            
            <div class="daily-reward" id="dailyReward">
                <div style="font-size: 20px; margin-bottom: 10px;">üéÅ Daily Login Bonus!</div>
                <div class="streak-counter">Day <span id="streakDay">1</span> Streak</div>
                <div style="font-size: 18px;">+<span id="bonusAmount">100</span> GP Earned!</div>
            </div>

            <div class="galaxy-map">
                <div class="planet planet-1" onclick="selectPlanet('Pyrion', 1)">
                    <div class="planet-info">
                        <div>üî• Pyrion</div>
                        <div>Fire World</div>
                    </div>
                </div>
                <div class="planet planet-2" onclick="selectPlanet('Aqueos', 2)">
                    <div class="planet-info">
                        <div>üåä Aqueos</div>
                        <div>Ocean World</div>
                    </div>
                </div>
                <div class="planet planet-3" onclick="selectPlanet('Voidex', 3)">
                    <div class="planet-info">
                        <div>üåå Voidex</div>
                        <div>Dark Matter</div>
                    </div>
                </div>
                <div class="planet planet-4" onclick="selectPlanet('Verdant', 4)">
                    <div class="planet-info">
                        <div>üåø Verdant</div>
                        <div>Bio World</div>
                    </div>
                </div>
                <div class="planet planet-5" onclick="selectPlanet('Aurelia', 5)">
                    <div class="planet-info">
                        <div>‚ú® Aurelia</div>
                        <div>Gold Planet</div>
                    </div>
                </div>
                <div class="planet planet-6" onclick="selectPlanet('Crimson', 6)">
                    <div class="planet-info">
                        <div>‚öîÔ∏è Crimson</div>
                        <div>War Zone</div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('bossScreen')">üêâ Boss Raid</button>
                <button class="action-btn" onclick="checkDailyReward()">üéÅ Daily Login</button>
                <button class="action-btn" onclick="shareGame()">üì§ Share Game</button>
            </div>
        </div>

        <!-- Mining Screen -->
        <div class="screen" id="miningScreen">
            <div class="header">
                <div class="logo">MINING: <span id="currentPlanet">Planet</span></div>
                <div class="resources">
                    <div class="resource">‚ö° <span id="energyMining">100</span></div>
                    <div class="resource">üíé <span id="shardsMining">0</span></div>
                </div>
            </div>

            <div class="mining-screen">
                <div class="mining-area" onclick="minePlanet()">
                    <div style="text-align: center; z-index: 2; position: relative;">
                        <div style="font-size: 32px; margin-bottom: 15px;">‚õèÔ∏è</div>
                        <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">TAP TO MINE</div>
                        <div style="font-size: 14px; opacity: 0.9;">+<span id="mineReward">10</span> Shards</div>
                    </div>
                </div>

                <div style="width: 100%; max-width: 320px;">
                    <div style="margin-bottom: 15px; font-size: 16px; font-weight: 600;">Energy: <span id="energyText">100/100</span></div>
                    <div class="energy-bar">
                        <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="watchAdForEnergy()" id="adBtn">üì∫ Watch Ad (+50 Energy)</button>
                    <button class="action-btn" onclick="battleAliens()">‚öîÔ∏è Battle Aliens</button>
                    <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
                </div>
            </div>
        </div>

        <!-- Boss Raid Screen -->
        <div class="screen" id="bossScreen">
            <div class="header">
                <div class="logo">BOSS RAID</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpBoss">0</span></div>
                    <div class="resource">‚öîÔ∏è <span id="damage">0</span></div>
                </div>
            </div>

            <div class="boss-raid">
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 24px; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);">üêâ COSMIC OVERLORD</h2>
                
                <div class="boss-image" onclick="attackBoss()">
                    üëπ
                </div>

                <div>
                    <div style="margin-bottom: 15px; font-size: 18px; font-weight: 600;">Boss Health: <span id="bossHealthText">1000/1000</span></div>
                    <div class="boss-health">
                        <div class="boss-health-fill" id="bossHealthFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="attackBoss()">‚öîÔ∏è ATTACK! (Tap)</button>
                    <button class="action-btn" onclick="watchAdForDamage()">üì∫ Watch Ad (2x Damage)</button>
                    <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
                </div>

                <div style="margin-top: 25px; font-size: 16px; opacity: 0.9; background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 15px;">
                    Your Damage: <span id="playerDamage" style="color: var(--primary-gold); font-weight: 700;">0</span><br>
                    Global Progress: <span id="globalProgress" style="color: var(--success-green); font-weight: 700;">0</span>%
                </div>
            </div>
        </div>

        <!-- Leaderboards Screen -->
        <div class="screen" id="leaderboardScreen">
            <div class="header">
                <div class="logo">LEADERBOARDS</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpLeaderboard">0</span></div>
                    <div class="resource">#<span id="playerRank">999</span></div>
                </div>
            </div>

            <div class="leaderboard">
                <h3 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 22px; text-align: center;">üèÜ TOP COLLECTORS</h3>
                <div id="leaderboardEntries">
                    <div class="leaderboard-entry top-3">
                        <div><span style="color: var(--primary-gold); font-size: 24px;">üëë</span> Loading...</div>
                        <div style="font-weight: 700; color: var(--primary-gold);">0 GP</div>
                    </div>
                </div>
                <div class="leaderboard-entry" style="background: rgba(255, 215, 0, 0.3); border: 2px solid var(--primary-gold);">
                    <div style="font-weight: 700;"><span id="leaderboardRank">999</span>. You</div>
                    <div style="font-weight: 700; color: var(--primary-gold);"><span id="leaderboardGP">0</span> GP</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Shop Screen -->
        <div class="screen" id="shopScreen">
            <div class="header">
                <div class="logo">SHOP & UPGRADES</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpShop">0</span></div>
                    <div class="resource">üíé <span id="shardsShop">0</span></div>
                </div>
            </div>

            <div class="shop-grid">
                <div class="shop-item" onclick="buyUpgrade('speed')">
                    <div>üöÄ</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Speed Boost</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;"><span id="speedCost">500</span> GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+25% Mining Speed</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('damage')">
                    <div>‚öîÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Damage Boost</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;"><span id="damageCost">750</span> GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+50% Battle Damage</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('energy')">
                    <div>‚ö°</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Energy Tank</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;"><span id="energyCost">1000</span> GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+50 Max Energy</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('multiplier')">
                    <div>üí∞</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">GP Multiplier</div>
                    <div style="color: var(--primary-gold); font-size: 16px; font-weight: 600;"><span id="multiplierCost">3000</span> GP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">+100% GP Gain</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Mini-Games Screen -->
        <div class="screen" id="minigamesScreen">
            <div class="header">
                <div class="logo">MINI-GAMES HUB</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpMinigames">0</span></div>
                    <div class="resource">üéÆ <span id="gameScore">0</span></div>
                </div>
            </div>

            <div class="shop-grid">
                <div class="shop-item" onclick="startAsteroidDodge()">
                    <div>‚òÑÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Asteroid Dodge</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Survive the asteroid field!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 300-1000 GP</div>
                </div>
                <div class="shop-item" onclick="startCryptoClicker()">
                    <div>üíé</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Crypto Clicker</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Click as fast as you can!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 200-800 GP</div>
                </div>
                <div class="shop-item" onclick="startPuzzleHack()">
                    <div>üß©</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Puzzle Hack</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Solve alien puzzles!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 100-500 GP</div>
                </div>
                <div class="shop-item" onclick="startPvPArena()">
                    <div>‚öîÔ∏è</div>
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">CX Arena PvP</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 8px;">Battle other players!</div>
                    <div style="color: var(--success-green); font-weight: 600;">Reward: 500-2000 GP</div>
                </div>
            </div>

            <div class="minigame-area" id="minigameArea">
                <h3 style="color: var(--primary-gold); font-size: 24px; margin-bottom: 15px;">Select a mini-game to start!</h3>
                <p style="font-size: 16px; opacity: 0.9;">Earn bonus GP and climb the leaderboards</p>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Wallet Screen -->
        <div class="screen" id="walletScreen">
            <div class="header">
                <div class="logo">TON WALLET</div>
                <div class="resources">
                    <div class="resource">üíé <span id="tonBalance">0</span> TON</div>
                    <div class="resource">üèÜ <span id="gpWallet">0</span> GP</div>
                </div>
            </div>

            <div class="wallet-container">
                <div class="wallet-status" id="walletStatus">
                    <div style="font-size: 60px; margin: 20px 0;">üîí</div>
                    <h3 style="color: var(--primary-gold); margin-bottom: 15px;">Connect Your TON Wallet</h3>
                    <p style="margin-bottom: 25px; opacity: 0.9;">Connect your wallet to earn real TON rewards!</p>
                    <div id="ton-connect"></div>
                </div>

                <div class="wallet-connected" id="walletConnected" style="display: none;">
                    <div style="font-size: 60px; margin: 20px 0;">‚úÖ</div>
                    <h3 style="color: var(--success-green); margin-bottom: 15px;">Wallet Connected!</h3>
                    <div id="walletAddress" style="font-size: 12px; opacity: 0.8; margin-bottom: 20px; word-break: break-all;"></div>
                    
                    <div class="wallet-actions">
                        <div class="shop-grid" style="margin: 25px 0;">
                            <div class="shop-item" onclick="withdrawTon()">
                                <div>üí∞</div>
                                <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">Withdraw TON</div>
                                <div style="color: var(--primary-gold); font-size: 14px;">Convert 10,000 GP ‚Üí 0.1 TON</div>
                            </div>
                            <div class="shop-item" onclick="depositTon()">
                                <div>üöÄ</div>
                                <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">Boost with TON</div>
                                <div style="color: var(--neon-blue); font-size: 14px;">0.05 TON ‚Üí 5000 GP + Bonuses</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar">
            <button class="nav-btn active" onclick="showScreen('galaxyScreen')">
                <div>üåå</div>
                <div>Galaxy</div>
            </button>
            <button class="nav-btn" onclick="showScreen('leaderboardScreen')">
                <div>üèÜ</div>
                <div>Ranks</div>
            </button>
            <button class="nav-btn" onclick="showScreen('shopScreen')">
                <div>üõí</div>
                <div>Shop</div>
            </button>
            <button class="nav-btn" onclick="showScreen('minigamesScreen')">
                <div>üéÆ</div>
                <div>Games</div>
            </button>
            <button class="nav-btn" onclick="showScreen('walletScreen')">
                <div>üí∞</div>
                <div>Wallet</div>
            </button>
        </div>

        <!-- Modals -->
        <div class="modal" id="adModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('adModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 28px;">üé¨ Watch Ad</h2>
                <p style="font-size: 18px; margin-bottom: 25px;">Watch this short video to get your reward!</p>
                <div style="width: 320px; height: 220px; background: linear-gradient(135deg, #333, #555); border-radius: 20px; margin: 25px auto; display: flex; align-items: center; justify-content: center; font-size: 64px; border: 3px solid var(--primary-gold); box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                    üì∫
                </div>
                <div style="margin: 25px 0;">
                    <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden; margin-bottom: 15px;">
                        <div id="adProgress" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary-gold), var(--secondary-orange)); transition: width 0.1s linear; border-radius: 4px;"></div>
                    </div>
                    <div style="font-size: 16px; font-weight: 600;">Ad progress: <span id="adTime" style="color: var(--primary-gold);">0</span>/5 seconds</div>
                </div>
                <button class="action-btn" onclick="skipAd()" id="skipBtn" style="display: none; margin-top: 20px;">‚úÖ Claim Reward</button>
            </div>
        </div>

        <div class="modal" id="rewardModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('rewardModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 32px;">üéâ Reward Earned!</h2>
                <div style="font-size: 80px; margin: 25px 0; animation: rewardBounce 1s ease infinite alternate;" id="rewardIcon">üíé</div>
                <div style="font-size: 28px; color: var(--primary-gold); font-weight: 700; margin-bottom: 20px;" id="rewardText">+100 GP</div>
                <p style="margin-top: 25px; font-size: 16px; opacity: 0.9;">Keep collecting to unlock more rewards!</p>
                <button class="action-btn" onclick="closeModal('rewardModal')" style="margin-top: 25px;">Continue</button>
            </div>
        </div>

        <div class="modal" id="upgradeModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('upgradeModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 32px;">üöÄ Upgrade Complete!</h2>
                <div style="font-size: 80px; margin: 25px 0; animation: upgradeGlow 2s ease-in-out infinite alternate;" id="upgradeIcon">‚ö°</div>
                <div style="font-size: 20px; margin-bottom: 20px; font-weight: 600;" id="upgradeText">Speed boost activated!</div>
                <p style="margin-top: 25px; font-size: 16px; opacity: 0.9;">Your ship is now more powerful!</p>
                <button class="action-btn" onclick="closeModal('upgradeModal')" style="margin-top: 25px;">Awesome!</button>
            </div>
        </div>

        <div class="modal" id="confirmModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('confirmModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 25px; font-size: 28px;" id="confirmTitle">Confirm Action</h2>
                <div style="font-size: 60px; margin: 25px 0;" id="confirmIcon">‚ùì</div>
                <div style="font-size: 18px; margin-bottom: 25px;" id="confirmText">Are you sure?</div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="confirmAction()" id="confirmBtn">Confirm</button>
                    <button class="action-btn" onclick="closeModal('confirmModal')" style="background: linear-gradient(135deg, rgba(255, 0, 0, 0.8), rgba(139, 0, 0, 0.8));">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="api.js"></script>
    <script src="wallet.js"></script>
    <script src="minigames.js"></script>
    <script src="game.js"></script>
</body>
</html>
