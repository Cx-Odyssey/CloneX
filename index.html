<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX Odyssey: Rise of the Collectors</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <link rel="stylesheet" href="styles/game.css">
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-logo">CX ODYSSEY</div>
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Initializing Game...</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgressBar"></div>
        </div>
    </div>

    <div class="game-container">
        <div class="stars" id="starfield"></div>

        <!-- Galaxy Screen -->
        <div class="screen" id="galaxyScreen">
            <div class="header">
                <div class="logo">CX ODYSSEY</div>
                <div class="resources">
                    <div class="resource">‚ö° <span id="energy">100</span></div>
                    <div class="resource">üíé <span id="shards">0</span></div>
                    <div class="resource">üèÜ <span id="gp">0</span></div>
                </div>
            </div>
            
            <div class="tg-user-info" id="tgUserInfo">
                <img class="tg-avatar" id="tgAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FFD700'/%3E%3Ctext x='50' y='65' text-anchor='middle' font-size='40' fill='%23000'%3Eüë§%3C/text%3E%3C/svg%3E">
                <div>
                    <div id="tgUserName" style="font-weight: 700; font-size: 16px;">Explorer</div>
                    <div style="font-size: 12px; opacity: 0.8;">Level <span id="tgUserLevel">1</span> ‚Ä¢ Rank #<span id="userRank">999</span></div>
                </div>
            </div>

            <div class="galaxy-map">
                <div class="planet planet-1" onclick="selectPlanet('Pyrion', 1)">
                    <div class="planet-info">
                        <div style="font-size: 16px; font-weight: 800; margin-bottom: 3px;">üî• Pyrion</div>
                        <div style="font-size: 10px;">Fire World</div>
                    </div>
                </div>
                <div class="planet planet-2" onclick="selectPlanet('Aqueos', 2)">
                    <div class="planet-info">
                        <div style="font-size: 16px; font-weight: 800; margin-bottom: 3px;">üåä Aqueos</div>
                        <div style="font-size: 10px;">Ocean World</div>
                    </div>
                </div>
                <div class="planet planet-3" onclick="selectPlanet('Voidex', 3)">
                    <div class="planet-info">
                        <div style="font-size: 16px; font-weight: 800; margin-bottom: 3px;">üåå Voidex</div>
                        <div style="font-size: 10px;">Dark Matter</div>
                    </div>
                </div>
                <div class="planet planet-4" onclick="selectPlanet('Verdant', 4)">
                    <div class="planet-info">
                        <div style="font-size: 16px; font-weight: 800; margin-bottom: 3px;">üåø Verdant</div>
                        <div style="font-size: 10px;">Bio World</div>
                    </div>
                </div>
                <div class="planet planet-5" onclick="selectPlanet('Aurelia', 5)">
                    <div class="planet-info">
                        <div style="font-size: 16px; font-weight: 800; margin-bottom: 3px;">‚ú® Aurelia</div>
                        <div style="font-size: 10px;">Gold Planet</div>
                    </div>
                </div>
                <div class="planet planet-6" onclick="selectPlanet('Crimson', 6)">
                    <div class="planet-info">
                        <div style="font-size: 16px; font-weight: 800; margin-bottom: 3px;">‚öîÔ∏è Crimson</div>
                        <div style="font-size: 10px;">War Zone</div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('bossScreen')">üêâ Boss Raid</button>
            </div>
        </div>

        <!-- Mining Screen -->
        <div class="screen" id="miningScreen">
            <div class="header">
                <div class="logo">MINING: <span id="currentPlanet">Planet</span></div>
                <div class="resources">
                    <div class="resource">‚ö° <span id="energyMining">100</span></div>
                    <div class="resource">üíé <span id="shardsMining">0</span></div>
                </div>
            </div>

            <div class="mining-screen">
                <div class="mining-area" onclick="minePlanet()">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; margin-bottom: 12px;">‚õèÔ∏è</div>
                        <div style="font-size: 16px; font-weight: 700; margin-bottom: 6px;">TAP TO MINE</div>
                        <div style="font-size: 12px; opacity: 0.9;">+<span id="mineReward">5</span> Shards</div>
                    </div>
                </div>

                <div style="width: 100%; max-width: 300px;">
                    <div style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">Energy: <span id="energyText">100/100</span></div>
                    <div class="energy-bar">
                        <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="watchAdForEnergy()" id="adBtn">üì∫ Ad (+25 Energy)</button>
                    <button class="action-btn" onclick="battleAliens()">‚öîÔ∏è Battle (+30 GP)</button>
                    <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
                </div>
            </div>
        </div>

        <!-- Boss Screen -->
        <div class="screen" id="bossScreen">
            <div class="header">
                <div class="logo">BOSS RAID</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpBoss">0</span></div>
                    <div class="resource">‚öîÔ∏è <span id="damage">0</span></div>
                </div>
            </div>

            <div style="text-align: center;">
                <h2 style="color: var(--primary-gold); margin-bottom: 20px; font-size: 20px;">üêâ COSMIC OVERLORD</h2>
                
                <div class="boss-image" onclick="attackBoss()">üëπ</div>

                <div>
                    <div style="margin-bottom: 12px; font-size: 16px; font-weight: 600;">Boss Health: <span id="bossHealthText">500/500</span></div>
                    <div class="boss-health">
                        <div class="boss-health-fill" id="bossHealthFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="attackBoss()">‚öîÔ∏è ATTACK!</button>
                    <button class="action-btn" onclick="watchAdForDamage()">üì∫ Ad (2x Damage)</button>
                    <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
                </div>

                <div style="margin-top: 20px; font-size: 14px; background: rgba(255, 215, 0, 0.1); padding: 12px; border-radius: 12px;">
                    Your Damage: <span id="playerDamage" style="color: var(--primary-gold); font-weight: 700;">0</span>
                </div>
            </div>
        </div>

        <!-- Shop Screen -->
        <div class="screen" id="shopScreen">
            <div class="header">
                <div class="logo">SHOP & UPGRADES</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpShop">0</span></div>
                    <div class="resource">üíé <span id="shardsShop">0</span></div>
                </div>
            </div>

            <div class="shop-grid">
                <div class="shop-item" onclick="buyUpgrade('speed')">
                    <div style="font-size: 40px; margin-bottom: 10px;">üöÄ</div>
                    <div style="font-size: 16px; font-weight: 700; margin-bottom: 6px;">Speed Boost</div>
                    <div style="color: var(--primary-gold); font-size: 14px; font-weight: 600;" id="speedCost">50 GP</div>
                    <div style="font-size: 10px; opacity: 0.8; margin-top: 4px;">+20% Mining Speed</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('damage')">
                    <div style="font-size: 40px; margin-bottom: 10px;">‚öîÔ∏è</div>
                    <div style="font-size: 16px; font-weight: 700; margin-bottom: 6px;">Damage Boost</div>
                    <div style="color: var(--primary-gold); font-size: 14px; font-weight: 600;" id="damageCost">75 GP</div>
                    <div style="font-size: 10px; opacity: 0.8; margin-top: 4px;">+30% Battle Damage</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('energy')">
                    <div style="font-size: 40px; margin-bottom: 10px;">‚ö°</div>
                    <div style="font-size: 16px; font-weight: 700; margin-bottom: 6px;">Energy Tank</div>
                    <div style="color: var(--primary-gold); font-size: 14px; font-weight: 600;" id="energyCost">100 GP</div>
                    <div style="font-size: 10px; opacity: 0.8; margin-top: 4px;">+25 Max Energy</div>
                </div>
                <div class="shop-item" onclick="buyUpgrade('multiplier')">
                    <div style="font-size: 40px; margin-bottom: 10px;">üí∞</div>
                    <div style="font-size: 16px; font-weight: 700; margin-bottom: 6px;">GP Multiplier</div>
                    <div style="color: var(--primary-gold); font-size: 14px; font-weight: 600;" id="multiplierCost">200 GP</div>
                    <div style="font-size: 10px; opacity: 0.8; margin-top: 4px;">+50% GP Gain</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Mini-Games Screen -->
        <div class="screen" id="minigamesScreen">
            <div class="header">
                <div class="logo">MINI-GAMES HUB</div>
                <div class="resources">
                    <div class="resource">üèÜ <span id="gpMinigames">0</span></div>
                    <div class="resource">
                        üé´ <span id="gameTickets">3</span>
                        <div style="font-size: 9px; opacity: 0.8;" id="ticketCooldown"></div>
                    </div>
                </div>
            </div>

            <div class="daily-combo-game">
                <h3 style="color: var(--primary-gold); margin-bottom: 15px; font-size: 18px;">üîÆ Daily Combo Code</h3>
                <p style="margin-bottom: 12px; opacity: 0.9; font-size: 13px;">Guess today's secret code!</p>
                <div class="combo-input">
                    <input type="text" class="combo-digit" maxlength="1" id="combo1">
                    <input type="text" class="combo-digit" maxlength="1" id="combo2">
                    <input type="text" class="combo-digit" maxlength="1" id="combo3">
                    <input type="text" class="combo-digit" maxlength="1" id="combo4">
                </div>
                <div class="combo-keypad">
                    <button class="combo-key" onclick="inputComboDigit('1')">1</button>
                    <button class="combo-key" onclick="inputComboDigit('2')">2</button>
                    <button class="combo-key" onclick="inputComboDigit('3')">3</button>
                    <button class="combo-key" onclick="inputComboDigit('4')">4</button>
                    <button class="combo-key" onclick="inputComboDigit('5')">5</button>
                    <button class="combo-key" onclick="inputComboDigit('6')">6</button>
                    <button class="combo-key" onclick="inputComboDigit('7')">7</button>
                    <button class="combo-key" onclick="inputComboDigit('8')">8</button>
                    <button class="combo-key" onclick="inputComboDigit('9')">9</button>
                    <button class="combo-key" onclick="clearCombo()" style="background: var(--danger-red);">Clear</button>
                    <button class="combo-key" onclick="inputComboDigit('0')">0</button>
                    <button class="combo-key" onclick="submitCombo()" style="background: var(--success-green); color: #000;">Submit</button>
                </div>
                <p style="font-size: 12px; opacity: 0.8;">Attempts: <span id="comboAttempts">3</span>/3 | Reward: 100 GP</p>
            </div>

            <div class="minigame-area" id="minigameArea">
                <h3 style="color: var(--primary-gold); font-size: 20px; margin-bottom: 12px;">Coming Soon!</h3>
                <p style="font-size: 14px; opacity: 0.9;">Mini-games are being developed...</p>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 8px;">Use tickets to play the daily combo above!</p>
            </div>

            <div class="action-buttons">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Tasks Screen -->
        <div class="screen" id="tasksScreen">
            <div class="header">
                <div class="logo">TASKS & MISSIONS</div>
                <div class="resources">
                    <div class="resource">‚úÖ <span id="completedTasks">0</span>/8</div>
                </div>
            </div>

            <!-- Balance Section (Pinned at Top) -->
            <div style="text-align: center; background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9)); border-radius: 25px; padding: 30px; margin: 20px 0; border: 1px solid rgba(255, 215, 0, 0.3); position: relative; overflow: hidden;">
                <div style="color: rgba(255, 255, 255, 0.7); font-size: 16px; margin-bottom: 10px;">Your balance</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
                    <div style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--primary-gold), var(--secondary-orange)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px;">üèÜ</div>
                    <div style="font-size: 36px; font-weight: bold; color: white;" id="taskBalanceDisplay">0</div>
                </div>
            </div>

            <!-- Task Tabs -->
            <div style="display: flex; background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 5px; margin: 20px 0; position: relative; z-index: 15;">
                <button style="flex: 1; background: linear-gradient(135deg, var(--primary-gold), var(--secondary-orange)); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 14px; cursor: pointer;" id="dailyTasksTab" onclick="switchTaskTab('daily')">
                    Daily Tasks
                </button>
                <button style="flex: 1; background: transparent; color: rgba(255, 255, 255, 0.6); border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 14px; cursor: pointer;" id="oneTimeTasksTab" onclick="switchTaskTab('onetime')">
                    Main Tasks
                </button>
            </div>

            <!-- Daily Tasks Content -->
            <div id="dailyTasksContent" style="position: relative; z-index: 10;">
                <!-- Daily Login Task -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary-gold), var(--secondary-orange)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üìÖ</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">Daily reward</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Log in daily</div>
                        </div>
                    </div>
                    <div style="background: var(--success-green); color: #000; padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 12px; flex-shrink: 0;" id="dailyLoginStatus">Completed</div>
                </div>

                <!-- Mine 10 Times Task -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF6B35, #D84315); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">‚õèÔ∏è</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">Mine crystals</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Mine 10 times (<span id="dailyMineCount">0</span>/10)</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="dailyMineBtn" onclick="claimDailyTask('mine')" disabled>+50 GP</button>
                </div>

                <!-- Boss Battle Task -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #9C27B0, #6A1B9A); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">‚öîÔ∏è</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">Battle cosmic overlord</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Attack boss 3 times (<span id="dailyBossCount">0</span>/3)</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="dailyBossBtn" onclick="claimDailyTask('boss')" disabled>+75 GP</button>
                </div>

                <!-- Daily Combo Task -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #7209B7, #4A148C); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üîÆ</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">Code puzzle</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Try the daily combo</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="dailyComboBtn" onclick="claimDailyTask('combo')" disabled>+30 GP</button>
                </div>
            </div>

            <!-- One-Time Tasks Content (Hidden by default) -->
            <div id="oneTimeTasksContent" style="display: none; position: relative; z-index: 10;">
                <!-- First Planet Visit -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 107, 53, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #FF6B35, #D84315); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üöÄ</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">First exploration</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Visit any planet for mining</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="firstPlanetBtn" onclick="claimOneTimeTask('planet')" disabled>+20 GP</button>
                </div>

                <!-- First Purchase -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 107, 53, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #4CAF50, #2E7D32); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üí∞</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">First upgrade</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Buy any upgrade from shop</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="firstPurchaseBtn" onclick="claimOneTimeTask('purchase')" disabled>+40 GP</button>
                </div>

                <!-- Collect 100 Shards -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 107, 53, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #00F5FF, #0091EA); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üíé</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">Crystal collector</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Collect 100 shards (<span id="oneTimeShardCount">0</span>/100)</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="shards100Btn" onclick="claimOneTimeTask('shards100')" disabled>+80 GP</button>
                </div>

                <!-- Invite 5 Friends -->
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; margin: 12px 0; background: linear-gradient(135deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.8)); border-radius: 20px; border: 1px solid rgba(255, 107, 53, 0.2); position: relative; overflow: hidden;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #E91E63, #AD1457); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üë•</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: 16px; color: white; margin-bottom: 4px;">Invite friends</div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">Refer 5 friends to game (<span id="referralCount">0</span>/5)</div>
                        </div>
                    </div>
                    <button style="background: var(--primary-gold); color: #000; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; font-size: 12px; flex-shrink: 0;" id="invite5Btn" onclick="claimOneTimeTask('invite5')" disabled>+200 GP</button>
                </div>
            </div>

            <div class="action-buttons" style="margin-top: 30px;">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Profile Screen (formerly Wallet) -->
        <div class="screen" id="profileScreen">
            <div class="header">
                <div class="logo">COMMAND CENTER</div>
                <div class="resources">
                    <div class="resource">#<span id="profileRank">999</span></div>
                </div>
            </div>

            <!-- Balance Section (Pinned at Top) -->
            <div style="text-align: center; background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.9)); border-radius: 25px; padding: 30px; margin: 20px 0; border: 1px solid rgba(255, 215, 0, 0.3); position: relative; overflow: hidden;">
                <div style="color: rgba(255, 255, 255, 0.7); font-size: 16px; margin-bottom: 10px;">Your balance</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
                    <div style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--primary-gold), var(--secondary-orange)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px;">üèÜ</div>
                    <div style="font-size: 36px; font-weight: bold; color: white;" id="profileBalanceDisplay">0</div>
                </div>
            </div>

            <!-- Section Tabs -->
            <div style="display: flex; background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 5px; margin: 20px 0; position: relative; z-index: 15;">
                <button style="flex: 1; background: linear-gradient(135deg, var(--success-green), #00CC70); color: #000; border: none; padding: 10px 5px; border-radius: 10px; font-weight: bold; font-size: 12px; cursor: pointer;" id="referralTab" onclick="switchProfileTab('referral')">
                    Referral
                </button>
                <button style="flex: 1; background: transparent; color: rgba(255, 255, 255, 0.6); border: none; padding: 10px 5px; border-radius: 10px; font-weight: bold; font-size: 12px; cursor: pointer;" id="leaderboardTab" onclick="switchProfileTab('leaderboard')">
                    Leaderboard
                </button>
                <button style="flex: 1; background: transparent; color: rgba(255, 255, 255, 0.6); border: none; padding: 10px 5px; border-radius: 10px; font-weight: bold; font-size: 12px; cursor: pointer;" id="walletTab" onclick="switchProfileTab('wallet')">
                    Wallet
                </button>
            </div>

            <!-- Referral Content -->
            <div id="referralContent" style="position: relative; z-index: 10;">
                <div style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.05)); border-radius: 25px; padding: 25px; margin: 20px 0; border: 1px solid rgba(0, 255, 136, 0.3); position: relative; overflow: hidden;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: var(--success-green); font-size: 20px; margin-bottom: 8px;">Referral Program</h3>
                        <p style="color: rgba(255, 255, 255, 0.8); font-size: 14px;">Invite friends and earn 25 GP per referral</p>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 15px; margin: 15px 0; text-align: center;">
                        <div style="color: var(--success-green); font-size: 12px; font-weight: 600; margin-bottom: 8px;">Your Referral Code</div>
                        <div style="font-family: monospace; font-weight: bold; font-size: 18px; color: white;" id="referralCode">Loading...</div>
                    </div>
                    
                    <button style="width: 100%; background: linear-gradient(135deg, var(--success-green), #00CC70); color: #000; border: none; padding: 15px; border-radius: 15px; font-weight: bold; font-size: 15px; cursor: pointer; margin-bottom: 20px;" onclick="shareReferral()">
                        üì§ Share Referral Link
                    </button>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: white;" id="totalReferrals">0</div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">Total Referrals</div>
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: white;" id="referralEarnings">0</div>
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">GP Earned</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Content (Hidden by default) -->
            <div id="leaderboardContent" style="display: none; position: relative; z-index: 10;">
                <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 107, 53, 0.05)); border-radius: 25px; padding: 25px; margin: 20px 0; border: 1px solid rgba(255, 215, 0, 0.3); position: relative; overflow: hidden;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: var(--primary-gold); font-size: 20px; margin-bottom: 8px;">Top Collectors</h3>
                        <p style="color: rgba(255, 255, 255, 0.8); font-size: 14px;">Compete with other players</p>
                    </div>
                    
                    <div id="leaderboardEntries">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; margin: 8px 0; background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(255, 107, 53, 0.05)); border-radius: 15px; border-left: 4px solid var(--primary-gold); position: relative; overflow: hidden;">
                            <div><span style="color: var(--primary-gold); font-size: 16px;">üëë</span> Loading...</div>
                            <div style="font-weight: 700; color: var(--primary-gold); font-size: 14px;">0 GP</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wallet Content (Hidden by default) -->
            <div id="walletContent" style="display: none; position: relative; z-index: 10;">
                <div style="background: linear-gradient(135deg, rgba(114, 9, 183, 0.15), rgba(74, 20, 140, 0.05)); border-radius: 25px; padding: 25px; margin: 20px 0; border: 1px solid rgba(114, 9, 183, 0.3); position: relative; overflow: hidden;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: var(--accent-purple); font-size: 20px; margin-bottom: 8px;">TON Wallet</h3>
                        <p style="color: rgba(255, 255, 255, 0.8); font-size: 14px;">Connect wallet for future airdrops</p>
                    </div>
                    
                    <button style="width: 100%; background: linear-gradient(135deg, var(--accent-purple), #5A0F8C); color: white; border: none; padding: 15px; border-radius: 15px; font-weight: bold; font-size: 15px; cursor: pointer; margin-bottom: 15px;" onclick="connectWallet()" id="connectWalletBtn">
                        üîó Connect Wallet
                    </button>
                    
                    <div id="walletInfo" style="display: none; text-align: center;">
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 15px; margin: 15px 0;">
                            <div style="color: var(--accent-purple); font-size: 12px; font-weight: 600; margin-bottom: 8px;">Connected Wallet</div>
                            <div style="word-break: break-all; font-family: monospace; font-size: 13px; color: white;" id="connectedAddress"></div>
                        </div>
                        <button style="width: 100%; background: var(--danger-red); color: white; border: none; padding: 12px; border-radius: 15px; font-weight: bold; font-size: 14px; cursor: pointer;" onclick="disconnectWallet()">
                            Disconnect Wallet
                        </button>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 20px; border-radius: 15px; margin-top: 20px; text-align: center;">
                        <div style="color: var(--accent-purple); font-size: 14px; font-weight: 600; margin-bottom: 12px;">Future Features</div>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 8px; background: rgba(114, 9, 183, 0.1); border-radius: 8px;">
                                <span style="font-size: 16px;">üöÄ</span>
                                <span style="font-size: 12px; color: rgba(255, 255, 255, 0.9);">CX Token Airdrops</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 8px; background: rgba(114, 9, 183, 0.1); border-radius: 8px;">
                                <span style="font-size: 16px;">üí∞</span>
                                <span style="font-size: 12px; color: rgba(255, 255, 255, 0.9);">NFT Rewards</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 8px; background: rgba(114, 9, 183, 0.1); border-radius: 8px;">
                                <span style="font-size: 16px;">üéÆ</span>
                                <span style="font-size: 12px; color: rgba(255, 255, 255, 0.9);">Exclusive Items</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons" style="margin-top: 30px;">
                <button class="action-btn" onclick="showScreen('galaxyScreen')">üåå Back to Galaxy</button>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar">
            <button class="nav-btn active" onclick="showScreen('galaxyScreen')">
                <div>üåå</div>
                <div>Galaxy</div>
            </button>
            <button class="nav-btn" onclick="showScreen('shopScreen')">
                <div>üõí</div>
                <div>Shop</div>
            </button>
            <button class="nav-btn" onclick="showScreen('minigamesScreen')">
                <div>üéÆ</div>
                <div>Games</div>
            </button>
            <button class="nav-btn" onclick="showScreen('tasksScreen')">
                <div>üìã</div>
                <div>Tasks</div>
            </button>
            <button class="nav-btn" onclick="showScreen('profileScreen')">
                <div>üë§</div>
                <div>Profile</div>
            </button>
        </div>

        <!-- Modals -->
        <div class="modal" id="adModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('adModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 20px; font-size: 18px;">üé¨ Watch Ad</h2>
                <p style="margin-bottom: 20px; font-size: 13px;">Watch this short video to get your reward!</p>
                <div style="width: 250px; height: 150px; background: #333; border-radius: 15px; margin: 20px auto; display: flex; align-items: center; justify-content: center; font-size: 48px;">
                    üì∫
                </div>
                <div style="margin: 20px 0;">
                    <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; margin-bottom: 12px;">
                        <div id="adProgress" style="width: 0%; height: 100%; background: var(--primary-gold); border-radius: 3px;"></div>
                    </div>
                    <div style="font-size: 13px;">Ad progress: <span id="adTime" style="color: var(--primary-gold);">0</span>/5 seconds</div>
                </div>
                <button class="action-btn" onclick="skipAd()" id="skipBtn" style="display: none;">‚úÖ Claim Reward</button>
            </div>
        </div>

        <div class="modal" id="rewardModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('rewardModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 20px; font-size: 18px;">üéâ Reward Earned!</h2>
                <div style="font-size: 60px; margin: 20px 0;" id="rewardIcon">üíé</div>
                <div style="font-size: 22px; color: var(--primary-gold); font-weight: 700; margin-bottom: 15px;" id="rewardText">+25 GP</div>
                <p style="margin-top: 20px; font-size: 13px;">Keep collecting to unlock more rewards!</p>
                <button class="action-btn" onclick="closeModal('rewardModal')" style="margin-top: 20px;">Continue</button>
            </div>
        </div>

        <div class="modal" id="upgradeModal">
            <div class="modal-content">
                <button class="close-btn" onclick="closeModal('upgradeModal')">&times;</button>
                <h2 style="color: var(--primary-gold); margin-bottom: 20px; font-size: 18px;">üöÄ Upgrade Complete!</h2>
                <div style="font-size: 60px; margin: 20px 0;" id="upgradeIcon">‚ö°</div>
                <div style="font-size: 18px; margin-bottom: 15px; font-weight: 600;" id="upgradeText">Speed boost activated!</div>
                <p style="margin-top: 20px; font-size: 13px;">Your ship is now more powerful!</p>
                <button class="action-btn" onclick="closeModal('upgradeModal')" style="margin-top: 20px;">Awesome!</button>
            </div>
        </div>
    </div>

    <script src="scripts/main.js"></script>
    <script src="scripts/gameplay.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/economy.js"></script>
    <script src="scripts/tasks.js"></script>
    <script src="scripts/minigames.js"></script>
    <script src="scripts/profile.js"></script>
    <script src="scripts/wallet.js"></script>
    <script src="components/modals.js"></script>
</body>
</html>
